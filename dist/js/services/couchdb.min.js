"use strict";var CouchDBService=angular.module("CouchDBService",[]);CouchDBService.factory("CouchDB",["$http",function(e){var n={COLON:":",COUNT:"?count=",DESCENDING:"descending=true",DESIGN:"/_design/",ENDKEY:"endkey=",HTTP:"http://",INCLUDE_DOCS:"include_docs=true",KEY:"key=",LIMIT:"limit=",QUOTE:'"',REVISION:"?rev=",SKIP:"skip=",SLASH:"/",STARTKEY:"startkey=",UUIDS:"_uuids",VIEW:"/_view/"},t={baseUrl:null,database:"test_main",designDocument:"baseline",host:"localhost",port:"5984"},o={baseUrl:null,database:null,designDocument:null,host:null,port:null,serverUrl:null},r={docId:null,endKey:null,key:null,limit:0,revisionId:null,skip:0,startKey:null,view:null,descending:null,includeDocs:null},i={data:null,docId:null,method:null,revisionId:null},d=function(e,n){var t=e.indexOf("?");return t>-1?e.concat("&",n):e.concat("?",n)},c=function(n,t,o){return e({method:n,url:t,data:o}).success(function(e){return e}).error(function(e,n,t,o){var r;throw r="CouchDB.js, Method "+o.method,r=r+", Status "+n,r=r+", Url "+o.url,new Error(r)})},l=function(e){return encodeURIComponent(e).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")},s=function(e){return u(e)+e.database},u=function(e){return n.HTTP.concat(e.host,n.COLON,e.port,n.SLASH)},a=function(e,t){if(t.designDocument)var o=s(e)+n.DESIGN+t.designDocument+n.VIEW+t.view;else{if(!e.designDocument)throw new Error(" Failed to form basic GET URL. A design document was expected.");var o=s(e)+n.DESIGN+e.designDocument+n.VIEW+t.view}if(t.descending&&(o=d(o,n.DESCENDING)),t.limit){var r=parseInt(t.limit);o=d(o,n.LIMIT+r)}if(t.skip){var r=parseInt(t.skip);o=d(o,n.SKIP+r)}return t.key?(o=d(o,n.KEY+l(n.QUOTE+t.key+n.QUOTE)),t.includeDocs&&(o=d(o,n.INCLUDE_DOCS)),o):(t.startKey&&(o=d(o,n.STARTKEY+l(n.QUOTE+t.startKey+n.QUOTE))),t.endKey&&(o=d(o,n.ENDKEY+l(n.QUOTE+t.endKey+n.QUOTE))),t.includeDocs&&(o=d(o,n.INCLUDE_DOCS)),o)},I=function(e,t){if(e.baseUrl){var o=e.baseUrl;return t.docId&&(o=o.concat(n.SLASH,t.docId)),o}throw new Error("Invalid baseUrl in Config object; Did you call the INIT method first? ")},E=function(e){o.designDocument=e.designDocument||o.designDocument,r.descending=e.descending||null,r.endKey=e.endKey||null,r.includeDocs=e.includeDocs||null,r.key=e.key||null,r.limit=e.limit||0,r.skip=e.skip||0,r.startKey=e.startKey||null,r.view=e.view||null},v=function(e){if(i.docId=e.docId||null,i.revId=e.revId||null,i.data=e.data||null,null===i.docId&&null===i.revId)return i.method="POST",!0;if(i.docId)return i.method="PUT",i.revisionId&&(i.data._rev=i.revisionId),!0;throw console.log("Write properties:",e),new Error("Invalid write properties object; couldn't determine PUT or POST verb.")};return{init:function(e,n){var r=n||!1;return e&&"object"==typeof e?(o.host=e.host||t.host,o.port=e.port||t.port,o.database=e.database||t.database,o.designDocument=e.designDocument||t.designDocument):(o.host=t.host,o.port=t.port,o.database=t.database,o.designDocument=t.designDocument),o.serverUrl=u(o),o.baseUrl=s(o),1==r?c("PUT",o.baseUrl):void 0},read:function(e){var t;if(e&&"object"==typeof e)if(e.view)E(e),t=a(o,r);else{if(!e.docId)throw console.log("GET properties:",e),new Error(" READ method: a document id is required when no view name is passed.");t=s(o),t=t.concat(n.SLASH,e.docId),e.revisionId&&(t=t.concat(n.REVISION,e.revisionId))}else t=s(o);return c("GET",t)},save:function(e){var n,t,r;if(!e||"object"!=typeof e){console.log("WRITE properties:",e);var d="SAVE method: method called with invalid properties object";throw new Error(d)}return v(e),r=I(o,i),t=i.method,n=i.data,c(t,r,n)},remove:function(e){if(e.docId&&e.revisionId){var t=s(o);return t=t.concat(n.SLASH,e.docId,n.REVISION,e.revisionId),c("DELETE",t)}throw console.log("DELETE properties:",e),new Error("DELETE method: both a Document Id and Revision Id are required to delete. One is missing.")},uuid:function(e){var t=o.serverUrl.concat(n.UUIDS);return e>0&&(t=t.concat(n.COUNT,e)),c("GET",t)}}}]);